name: DEV Workflow

on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: '1.8'
        distribution: 'adopt'
        cache: maven
    - name: Build with Maven
      run: mvn clean install

    - name: Send approval request
        uses:create-issue-from-file@v2
        with:
          title: 'Deployment Approval Request'
          assignees: 'Niladri579'
          labels: 'approval'
          body: |
            Please approve this deployment by commenting :+1: on this issue.
      - name: Wait for approval
        uses: wait-for-approval@v1
        with:
          issue-number: ${{ steps.send_approval_request.outputs.number }}
          repository-token: ${{ secrets.GITHUB_TOKEN }}
    
    
  Deploy-dev:
    needs: build
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: '1.8'
        distribution: 'adopt'
        cache: maven
    - name: Build with Maven
      run: mvn clean install
    - name: Deploy 
      run: echo "Hi World!"
    - name: Send approval request
      uses: peter-evans/create-issue-from-file@v2
      with:
        title: 'Deployment Approval Request'
        assignees: 'username'
        labels: 'approval'
        body: |
            Please approve this deployment by commenting :+1: on this issue.
    - name: Wait for approval
      uses: wait-for-approval@v1
      with:
          issue-number: ${{ steps.send_approval_request.outputs.number }}
          repository-token: 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
  unit-testing:
    needs: Deploy-dev
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: '1.8'
        distribution: 'adopt'
        cache: maven

    - name: Unit Testing
      run: echo "Hello World!"

